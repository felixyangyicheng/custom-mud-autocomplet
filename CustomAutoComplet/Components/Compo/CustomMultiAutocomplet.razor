@typeparam TItem

<MudPaper Class="multi-autocomplete pa-2" Style="position:relative">

    <!-- Chips + Input -->
    <div class="d-flex flex-wrap gap-1 align-center">

        @foreach (var item in Values)
        {
            <MudChip T="TItem"
                     OnClose="() => RemoveAsync(item)">
                @DisplayFunc(item)
            </MudChip>
        }

        <MudTextField T="string"
                      Class="flex-grow-1"
                      @bind-Value="_searchText"
                      Placeholder="@(Values.Any() ? "" : Placeholder)"
                      Immediate="true"
                      Disabled="Disabled"
                      DebounceInterval="DebounceInterval"
                      OnDebounceIntervalElapsed="HandleSearchAsync"
                      @onkeydown="OnKeyDown" />
    </div>

    <!-- Dropdown -->
    @if (_open)
    {
        <MudPaper Class="mt-1" Elevation="8" Style="@PopupStyle">

            @if (_loading)
            {
                @LoadingTemplate
            }
            else if (!_items.Any())
            {
                @EmptyTemplate
            }
            else
            {
                <MudList T="TItem" Dense="true">
                    @foreach (var item in _items)
                    {
                        <MudListItem T="TItem" Class="@GetItemClass(item)"
                                     @onmouseover="() => _highlighted = item"
                                     OnClick="() => SelectAsync(item)">

                            @ItemTemplate(new AutocompleteItemContext<TItem>
                            {
                                Item = item,
                                SearchText = _searchText
                            })

                        </MudListItem>
                    }
                </MudList>
            }

            @if (_error != null)
            {
                @ErrorTemplate(_error)
            }

        </MudPaper>
    }

</MudPaper>

@code
{
    [Parameter] public RenderFragment LoadingTemplate { get; set; } = @<MudProgressLinear Indeterminate />;

    [Parameter] public RenderFragment EmptyTemplate { get; set; } = @<MudText Class="pa-2" Color="Color.Secondary">Aucun résultat</MudText>;

    [Parameter] public RenderFragment<Exception> ErrorTemplate { get; set; } = ex => @<MudAlert Severity="Severity.Error">@ex.Message</MudAlert>;








}
